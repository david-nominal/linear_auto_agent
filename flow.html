<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Spiky Flow</title>
<script src="https://cdn.jsdelivr.net/npm/mermaid@11/dist/mermaid.min.js"></script>
<style>
  body {
    background: #0d1117;
    display: flex;
    justify-content: center;
    padding: 40px 20px;
    margin: 0;
    font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
  }
  #diagram {
    background: #161b22;
    border-radius: 12px;
    padding: 40px;
    box-shadow: 0 4px 24px rgba(0,0,0,0.4);
    max-width: 900px;
    width: 100%;
  }
</style>
</head>
<body>
<div id="diagram">
<pre class="mermaid">
flowchart LR
    LINEAR["üîµ Linear Issue"]
    TRIAGE{"üîç Triage"}
    CLARIFY["‚ùì Post Clarification<br/>Comment on Linear"]
    IMPLEMENT["‚ö° Implement"]
    COMPILE{"üõ†Ô∏è Compile + Lint<br/>(gradlew / pnpm)"}
    SELF_REVIEW{"üîé Self-Review"}
    PUSH["üöÄ Push PR<br/>(backend / frontend / both)"]
    FETCH_COMMENTS["üì• Fetch <br> - PR Comments (Greptile, Devin, Human)" <br> - CI status]
    FIX["üîß Fix Issues"]
    FIX_COMPILE{"üõ†Ô∏è Compile + Lint"}
    FIX_REVIEW{"üîé Self-Review"}
    FIX_PUSH["üöÄ Push Fixes"]
    NOTIFY["‚úÖ Notify Reviewer"]
    GIVEUP["üõë Give Up<br/>(Max Revisions Exceeded)"]

    LINEAR --> TRIAGE

    TRIAGE -- "easy" --> PLAN["üìù Plan<br/>(backend / frontend / both)"]
    TRIAGE -- "medium" --> PLAN
    PLAN -- "easy" --> IMPLEMENT
    PLAN -- "medium" --> APPROVE{"üë§ Human Revises<br/>/ Approves Plan"}
    APPROVE -- "approved" --> IMPLEMENT
    TRIAGE -- "complex" --> SKIPPED["‚è≠Ô∏è Skipped"]
    TRIAGE -- "needs_clarification" --> CLARIFY
    CLARIFY -.-> LINEAR

    IMPLEMENT --> COMPILE
    COMPILE -- "fails" --> IMPLEMENT
    COMPILE -- "passes" --> SELF_REVIEW
    SELF_REVIEW -- "issues found" --> IMPLEMENT
    SELF_REVIEW -- "looks good" --> PUSH

    PUSH --> FETCH_COMMENTS

    FETCH_COMMENTS -- "no more relevant comments<br/>CI passing" --> NOTIFY
    FETCH_COMMENTS -- "max revisions<br/>exceeded" --> GIVEUP
    FETCH_COMMENTS -- "comments found" --> FIX
    FIX --> FIX_COMPILE
    FIX_COMPILE -- "fails" --> FIX
    FIX_COMPILE -- "passes" --> FIX_REVIEW
    FIX_REVIEW -- "issues found" --> FIX
    FIX_REVIEW -- "looks good" --> FIX_PUSH
    FIX_PUSH -- "next revision" --> FETCH_COMMENTS

    style LINEAR fill:#1a6dd4,stroke:#58a6ff,color:#fff
    style TRIAGE fill:#6e40c9,stroke:#a371f7,color:#fff
    style CLARIFY fill:#d4a017,stroke:#e3b341,color:#000
    style PLAN fill:#d4a017,stroke:#e3b341,color:#000
    style APPROVE fill:#6e40c9,stroke:#a371f7,color:#fff
    style IMPLEMENT fill:#238636,stroke:#3fb950,color:#fff
    style COMPILE fill:#d4a017,stroke:#e3b341,color:#000
    style SELF_REVIEW fill:#6e40c9,stroke:#a371f7,color:#fff
    style PUSH fill:#1a6dd4,stroke:#58a6ff,color:#fff
    style FETCH_COMMENTS fill:#d4a017,stroke:#e3b341,color:#000
    style FIX fill:#238636,stroke:#3fb950,color:#fff
    style FIX_COMPILE fill:#d4a017,stroke:#e3b341,color:#000
    style FIX_REVIEW fill:#6e40c9,stroke:#a371f7,color:#fff
    style FIX_PUSH fill:#1a6dd4,stroke:#58a6ff,color:#fff
    style NOTIFY fill:#238636,stroke:#3fb950,color:#fff
    style SKIPPED fill:#6e7681,stroke:#8b949e,color:#fff
    style GIVEUP fill:#da3633,stroke:#f85149,color:#fff
</pre>
</div>
<script>
  mermaid.initialize({
    theme: 'dark',
    themeVariables: {
      primaryColor: '#238636',
      lineColor: '#8b949e',
      textColor: '#c9d1d9',
      fontSize: '14px'
    }
  });
</script>
</body>
</html>
